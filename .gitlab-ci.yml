stages:
  - build
  - deploy

variables:
  DJANGO_SETTINGS_MODULE: "MuslimLife.settings"
  HEROKU_APP_NAME: "muslim-life"

before_script:
  - apt-get update -y && apt-get install -y python3-pip
  - pip3 install -U pip
  - source ~/.local/share/virtualenvs/project-RGpKCLMb/bin/activate
  - pip install -r requirements.txt

build-job:
  stage: build
  script:
    - echo "Collecting static files..."
    - python manage.py collectstatic --noinput

deploy-job:
  stage: deploy
  environment: production
  script:
    - echo "Deploying application to Heroku..."
    - curl https://cli-assets.heroku.com/install.sh | sh
    - heroku --version
    - heroku login -i
    - git push heroku master
